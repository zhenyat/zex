
<h1>Demo: API Calls</h1>

<div class="block">
  <%= form_tag api_calls_path, method: :get do %>
    <%= select_tag :dotcom,  options_from_collection_for_select(@dotcoms, "id", "name", 
      @dotcom&.id), prompt: "- Dotcom", onchange: "this.form.submit()" 
    %>
    <%= select_tag :api,  options_from_collection_for_select(@apis, "id", "mode", 
      @api&.id), prompt: "- Api Mode", onchange: "this.form.submit()" 
    %>
    <%= select_tag :call,  options_from_collection_for_select(@calls, "id", "name", 
      @call&.id), prompt: "- Api Calls", onchange: "this.form.submit()" 
    %>
  <% end %>
</div>

<% if @call %>
  <div class="block mt-4">
    <table class="table table-striped table-primary table-sm">
      <caption class="caption-top">Request parameters:</caption>
      <tr>
        <td>Dotcom:</td>
        <td><%= @call.api.dotcom.name %></td>
      </tr>
      <tr>
        <td>API Mode:</td>
        <td><%= @api.mode %></td>
      </tr>
      <tr>
        <td>Call:</td>
        <td><%= @call.name %></td>
      </tr>
      <tr>
        <td>URI:</td>
        <td><%= @request.uri %></td>
      </tr>
    </table>
  </div>

  <% if @response[:error].nil? %>
    <h6>Reponse</h6>
    <div class="block mb-4 bg-success" style="--bs-bg-opacity: .5;">
      <%= @response %>
    </div>
  <% else %>
    <span class="badge mb-4 bg-danger fs-6">
      <pre><%= @response[:error] %></pre>
    </span>
  <% end %>
<% end %>
